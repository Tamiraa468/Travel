generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tour {
  id           String     @id @default(cuid())
  title        String
  slug         String     @unique
  description  String?
  days         Int
  priceFrom    Float
  mainImage    String?
  images       String[]   @default([])
  includes     String[]   @default([])
  highlights   String[]   @default([])
  mapEmbed     String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  dates        TourDate[]
  bookings     Booking[]
}

model TourDate {
  id        String   @id @default(cuid())
  tour      Tour     @relation(fields: [tourId], references: [id])
  tourId    String
  startDate DateTime
  endDate   DateTime
  capacity  Int
  createdAt DateTime @default(now())
  bookings  Booking[]
}

model Customer {
  id        String    @id @default(cuid())
  firstName String
  lastName  String
  email     String    @unique
  phone     String?
  createdAt DateTime  @default(now())
  bookings  Booking[]
}

model Booking {
  id           String    @id @default(cuid())
  tour         Tour      @relation(fields: [tourId], references: [id])
  tourId       String
  tourDate     TourDate  @relation(fields: [tourDateId], references: [id])
  tourDateId   String
  customer     Customer  @relation(fields: [customerId], references: [id])
  customerId   String
  quantity     Int
  totalPrice   Float
  status       BookingStatus @default(PENDING)
  payment      Payment?
  createdAt    DateTime  @default(now())
}

model Payment {
  id          String    @id @default(cuid())
  booking     Booking   @relation(fields: [bookingId], references: [id])
  bookingId   String    @unique
  provider    String
  providerId  String
  amount      Float
  currency    String    @default("USD")
  status      PaymentStatus @default(UNPAID)
  createdAt   DateTime  @default(now())
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum PaymentStatus {
  UNPAID
  PAID
  REFUNDED
}
